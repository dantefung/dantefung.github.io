---
title: 命令行工具挂代理方式
date: 2021-06-27 10:36:48
tags:
 - 运维
categories:
 - 运维
---

# 命令行工具挂代理方式

## git 代理

### 全局代理
```
git config --global http.proxy http://127.0.0.1:8087
git config --global http.proxy 'socks5://127.0.0.1:1080'
git config --global https.proxy 'socks5://127.0.0.1:1080'
```
### 清除配置

```
git config --global --unset http.proxy
git config --global --unset https.proxy
```

### 临时代理
```
git clone -c http.proxy=http://127.0.0.1:8087  

git clone -c sock.proxy=sock5://127.0.0.1:1086  http://XXX.git

ALL_PROXY=socks5://127.0.0.1:1080 git clone xxx

ALL_PROXY=socks5://127.0.0.1:1080 git push xxx

```

## curl代理

```
curl -x 127.0.0.1:8087 google.com
```

**参数说明:**

`-x`  设置代理，格式为host[:port]，port的缺省值为1080

## wget代理

```
wget -Y on -e "http_proxy=http://127.0.0.1:8087" "google.com"
```

**参数说明:**

`-Y`  是否使用代理

`-e`  执行命令

## powershell代理

**以管理员的身份运行powershell:**

```
Start-Process powershell -Verb runAs
```

**设置代理**

```
netsh winhttp set proxy "127.0.0.1:7890"
```

**检查代理:**

```
 netsh winhttp show proxy
```
**测试连接:**

```
iwr -Uri https://www.google.com

# or

iwr -Uri https://www.google.com | Select-Object -Property StatusCode
```

**关闭proxy:**

```
netsh winhttp reset proxy
```

## bash终端设置代理

```
 export http_proxy='http://localhost:8118'
 export https_proxy='http://localhost:8118'
```

## git bash 终端设置代理

```
export https_proxy=socks5://127.0.0.1:1080
```




## socks5转http代理

**目标: 定制socks5代理转发**

```
　　　｜＝＝＝＝＞｜　　　　　　　｜＝＝＝＝＞｜　　　　　　　｜＝＝＝＝＞｜
浏览器｜　　　　　｜Ｐｒｉｖｏｘｙ｜　　　　　｜ＳＯＣＫＳ代理｜　　　　　｜目标网站
　　　｜＜＝＝＝＝｜　　　　　　　｜＜＝＝＝＝｜　　　　　　　｜＜＝＝＝＝｜

      ｜此阶段是　｜　　　　　　　｜此阶段是　｜　　　　　　　｜此阶段是　｜

　　　｜ＨＴＴＰ　｜　　　　　　　｜ＳＯＣＫＳ｜　　　　　　　｜ＨＴＴＰ　｜
```

**privoxy简介**

[Privoxy](https://www.privoxy.org/faq/installation.html#WHICHOS) 是一个代理软件。支持的平台非常多，[了解更多](https://www.privoxy.org)
> 借由 Privoxy，我们可以控制出去的请求，还可以改写返回的响应。不必要的请求 – 比如视频广告的地址、图片广告的地址，我们可以直接 block 掉；不必要的响应内容 – 比如页面中的文字广告，我们可以借由 filter 过滤掉，不让它们在浏览器页面上显示。
> -- 摘自: https://www.cnblogs.com/hongdada/p/10787924.html

**下载地址:**

[Download Address](https://sourceforge.net/projects/ijbswa/files/Win32/)


## windows平台

**windows privoxy安装目录说明:**

```
PS D:\Program Files (x86)\Privoxy> tree /f
卷 软件 的文件夹 PATH 列表
卷序列号为 0003-DE55
D:.
│  AUTHORS.txt
│  config.txt  ## 主配置文件
│  default.action
│  default.filter
│  LICENSE.txt
│  match-all.action
│  privoxy.exe
│  privoxy.log
│  privoxy_uninstall.exe
│  README.txt
│  trust.txt
│  user.action
│  user.filter
```

**在配置文件config.txt中添加如下配置:**

**代理的IP地址与监听端口:**

```
listen-address  127.0.0.1:8118
```

**配置转发请求的代理IP地址与监听端口:**

```
forward-socks5 / 127.0.0.1:1080 .
```
## linux平台

**系统环境**

笔者的系统版本为: ubuntu20.4
笔者的socks代理为: 127.0.0.1:1080
使用的代理工具为: clashx + 某供应商提供的trojan机场 or `ssh -D` + 自建trojan机场


> 笔者自己用于备份内容
`ssh -D` 挂代理脚本:

```
#!/usr/bin/bash
PID=$(ps aux|grep ssh|grep fgnTN|grep -v grep |awk '{print $2}')
echo $PID
# $? shell最后运行的后台PID
# $$ shell本身的PID(Proccess ID)
# $- 使用Set命令设定的Flag一览
# $* 所有参数列表。如"$*"用「"」括起来的情况、以"$1 $2 … $n"的形式输出所有参数。
# $@ 所有参数列表。如"$@"用「"」括起来的情况、以"$1" "$2" … "$n" 的形式输出所有参数。
# $# 添加到shell的参数个数
# $0 shell本身的文件名
# $1～$n 添加到Shell的各参数值。$1是第1参数、$2是第2参数…

if [ $? -eq 0 -a ! -z "$PID" ]
then
 echo "SSH Proxy server is on..."
else
 echo "SSH Proxy server is death..."
 ssh -fgnTN -D 7079 yourusernam@yourhostname
 if [ $? -eq 0 ]
 then
 echo "SSH Proxy Service restart successd."
 else
 echo "SSH Proxy Service restart failed."
 fi
fi
```

**安装privoxy**

```
sudo apt install privoxy
```

**更改privoxy配置**

```
sudo vi /etc/privoxy/config
```
在 froward-socks4下面添加一条socks5的，地址是127.0.0.1:1080。注意最后有一个.
```
forward-socks5   /  127.0.0.1:1080 .
```

**重启privoxy服务**

```
sudo systemctl restart privoxy.serivce
```
或者
```
sudo service privoxy restart
```

**测试**

```
dantefung@WIN-RL03VFUMQFV:/mnt/d/scripts$ export http_proxy='http://127.0.0.1:8118'
dantefung@WIN-RL03VFUMQFV:/mnt/d/scripts$ curl -I www.google.com
```

期望结果:

```
HTTP/1.1 200 OK
Content-Type: text/html; charset=ISO-8859-1
P3P: CP="This is not a P3P policy! See g.co/p3phelp for more info."
Date: Thu, 17 Feb 2022 17:23:08 GMT
Server: gws
X-XSS-Protection: 0
X-Frame-Options: SAMEORIGIN
Transfer-Encoding: chunked
Expires: Thu, 17 Feb 2022 17:23:08 GMT
Cache-Control: private
Set-Cookie: 1P_JAR=2022-02-17-17; path=/; domain=.google.com; Secure
Set-Cookie: NID=511=pcqU1X_oEh95me7ZnpKgUNGTmzSvSRIizVdUHVZTDZGQBwiyLtRMKW1ZokdQsczrA0TeX8EmEV2OpihlqPgK-6-JAw8ZmQrcPYcFyfbEliFd2PxPdZOPZ2A9M_svTXEITKNtoW_1k6t3tViNObjVly-IxFJxPApfaAg92qrK-3k; path=/; domain=.google.com; HttpOnly
Proxy-Connection: keep-alive
```




# Reference

- [Windows 下 powershell 使用代理](https://www.jianshu.com/p/e2a144e42bf9)

- [Privoxy教程](https://web.archive.org/web/20220106110033/https://www.cnblogs.com/hongdada/p/10787924.html)

- [Mac/Ubuntu18.04 使用 privoxy 将 socks 转为 https、http 和 ftp 代理_α-geek 的专栏 - CSDN 博客](https://blog.csdn.net/gongchenyu/article/details/80482981)


